# Step 4: Merge trigger input runtime config with strategy config

runtime_config = trigger_config.taskRuntimeConfig
print("Runtime config received:", runtime_config)

# Get dicts
runtime_dict = runtime_config.dict(exclude_none=True, by_alias=True)
existing_eval_dynamic = eval_config.dynamic.dict()

# Safely merge evalRunTimeParams (override only if non-empty)
existing_params = existing_eval_dynamic.get("evalRunTimeParams", {})
runtime_params = runtime_dict.get("evalRunTimeParams", {})

# Safe merge â€“ only override if runtime value is not empty or None
merged_eval_params = {
    **existing_params,
    **{k: v for k, v in runtime_params.items() if v not in ("", None)}
}

# Build final dynamic config
final_dynamic = {"evalRunTimeParams": merged_eval_params}

# Replace back into eval_config
eval_config.dynamic = EvaluationRuntimeConfig(**final_dynamic)






updated_dynamic_config = eval_config.dynamic.dict()
runtime_dict = runtime_config.dict(exclude_none=True, by_alias=True)

for key, val in runtime_dict.items():
    if isinstance(val, dict):
        updated_dynamic_config[key] = {
            **updated_dynamic_config.get(key, {}),
            **{k: v for k, v in val.items() if v != "" and v is not None}
        }
    elif val != "" and val is not None:
        updated_dynamic_config[key] = val
