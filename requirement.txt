# Fetch strategy
strategy = db.session.query(EvaluationStrategies).filter(EvaluationStrategies.id == config['strategyId']).first()

if not strategy:
    raise Exception("Evaluation Strategy not found")

logger.info(f"Raw strategy.config: {strategy.config} (type: {type(strategy.config)})")

# Safely unwrap the nested 'config' dict
strategy_config_dict = strategy.config
if isinstance(strategy_config_dict, str):
    strategy_config_dict = json.loads(strategy_config_dict)

# Unwrap the nested 'config' key
inner_config = strategy_config_dict.get("config", {}) if "config" in strategy_config_dict else strategy_config_dict

static_cfg = inner_config.get("static", {})
dynamic_cfg = inner_config.get("dynamic", {})

logger.info(f"Parsed static_cfg: {static_cfg}")
logger.info(f"Parsed dynamic_cfg: {dynamic_cfg}")
